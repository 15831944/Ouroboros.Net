@model Ouroboros.Model.Dto.SysActionDto

@{
    ViewBag.Title = "Edit";
    Layout = "~/Areas/System/Views/Shared/_layuicms.cshtml";
}

<div class="layui-container">
    <div class="layui-row">
        <div class="layui-col-md9">
            <form class="layui-form" action="">
                <input type="hidden" name="Id" value="@Model.Id" />
                <div class="layui-form-item">
                    <label class="layui-form-label">权限名称</label>
                    <div class="layui-input-block">
                        <input type="text" name="ActionName" required lay-verify="required" placeholder="请输入权限名称" autocomplete="off" class="layui-input" value="@Model.ActionName">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">权限编码</label>
                    <div class="layui-input-block">
                        <input type="text" name="ActionCode" required lay-verify="required" placeholder="请输入权限编码" autocomplete="off" class="layui-input" value="@Model.ActionCode">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">权限类型</label>
                    <div class="layui-input-block">
                        @Html.EnumDropDownListFor(model => model.ActionType, htmlAttributes: new { @class = "layui-input" })
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">上级</label>
                    <div class="layui-input-block">
                        <input type="hidden" name="ParentId" id="ParentId">
                        <input type="text" id="ParentTree" name="ParentTree" lay-filter="ParentTree" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">url地址</label>
                    <div class="layui-input-block">
                        <input type="text" name="Url" required lay-verify="required" placeholder="请输入url地址" autocomplete="off" class="layui-input" value="@Model.Url">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">Icon图标</label>
                    <div class="layui-input-block">
                        <input type="text" name="Icon" required lay-verify="required" placeholder="请输入Icon图标" autocomplete="off" class="layui-input" value="@Model.Icon">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">顺序</label>
                    <div class="layui-input-block">
                        <input type="text" name="Sort" required lay-verify="required" placeholder="请输入顺序" autocomplete="off" class="layui-input" value="@Model.Sort">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">区域</label>
                    <div class="layui-input-block">
                        <input type="text" name="Area" required lay-verify="required" placeholder="请输入区域" autocomplete="off" class="layui-input" value="@Model.Area">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">控制器</label>
                    <div class="layui-input-block">
                        <input type="text" name="Controller" required lay-verify="required" placeholder="请输入控制器" autocomplete="off" class="layui-input" value="@Model.Controller">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">功能</label>
                    <div class="layui-input-block">
                        <input type="text" name="Action" required lay-verify="required" placeholder="请输入功能" autocomplete="off" class="layui-input" value="@Model.Action">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">安全方法</label>
                    <div class="layui-input-block">
                        @Html.EnumDropDownListFor(model => model.HttpMethd, htmlAttributes: new { @class = "layui-input" })
                    </div>
                </div>

                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn" lay-submit lay-filter="formDemo">立即提交</button>
                        <button type="reset" class="layui-btn layui-btn-primary">重置</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>
@section Scripts{
    <script src="~/Scripts/layui.module.js"></script>
    <script>
        layui.use(['treeSelect', 'form'], function () {
            var form = layui.form;
            form.on('submit(formDemo)', function (data) {
                var index = top.layer.msg('数据提交中，请稍候', { icon: 16, time: false, shade: 0.8 });
                $.post("/action/add", data.field, function (result) {
                    if (result.status == "0") {
                        setTimeout(function () {
                            top.layer.close(index);
                            top.layer.msg(result.msg);
                            layer.closeAll("iframe");
                            //刷新父页面
                            parent.location.reload();
                        }, 500);
                    }
                    else {
                        top.layer.close(index);
                        layer.msg(result.msg);
                    }
                });
                return false;
            });

            var treeSelect = layui.treeSelect;
            treeSelect.render({
                // 选择器
                elem: '#ParentTree',
                // 数据
                data: '/Action/LoadTree?_id=0&a=' + ouroboros.getGuid(),
                // 异步加载方式：get/post，默认get
                type: 'get',
                // 占位符
                placeholder: '请选择上级',
                // 是否开启搜索功能：true/false，默认false
                search: true,
                // 点击回调
                click: function (d) {
                    console.log(d);
                    $('#ParentId').val(d.current.id)
                },
                // 加载完成后的回调函数
                success: function (d) {
                    console.log(d);
                    //选中节点，根据id筛选
                    treeSelect.checkNode('ParentTree', @Model.ParentId);
                    console.log($('#ParentTree').val());
                    //                  获取zTree对象，可以调用zTree方法
                    var treeObj = treeSelect.zTree('ParentTree');
                    //                  console.log(treeObj);

                    //                刷新树结构
                    treeSelect.refresh('ParentTree');
                }
            });
        });
    </script>
}